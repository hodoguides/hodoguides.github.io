<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HodoGuides</title>

<link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
  :root{
    --nav-h: 72px;
    --cards-h: 160px;
    --globe-lift: -8vh;
    --accent:#8f88ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter;
    color:#fff; background:#0e1420; overflow:hidden;
    background-image:
      radial-gradient(ellipse at 50% 40%, #1d2845 0%, #0e1420 60%, #0b0f18 100%),
      radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.18) 0, rgba(255,255,255,0) 100%),
      radial-gradient(2px 2px at 70% 60%, rgba(255,255,255,.14) 0, rgba(255,255,255,0) 100%),
      radial-gradient(1.5px 1.5px at 40% 80%, rgba(255,255,255,.10) 0, rgba(255,255,255,0) 100%);
    background-repeat:no-repeat;
  }

  header{
    position:absolute; inset:20px auto auto 20px; z-index:10;
    font-weight:800; font-size:28px; letter-spacing:.3px;
    text-shadow:0 2px 10px rgba(0,0,0,.35);
  }
  .search-bar{
    position:absolute; left:50%; top:74px; transform:translateX(-50%);
    width:min(820px,86%); z-index:10;
  }
  .search-bar input{
    width:100%; padding:14px 18px; font-size:16px; color:#fff;
    background:rgba(255,255,255,.14); border:0; border-radius:28px;
    outline:none; backdrop-filter: blur(6px);
  }

  #map{ position:absolute; inset:0;
    padding-bottom: calc(var(--cards-h) + var(--nav-h) + env(safe-area-inset-bottom, 0px));
  }
  #map .mapboxgl-canvas{ transform: translateY(var(--globe-lift)); transform-origin:center; }

  /* Guides rail */
  .guides{
    position:absolute; left:0; right:0;
    bottom: calc(var(--nav-h) + 10px + env(safe-area-inset-bottom, 0px));
    height: var(--cards-h);
    padding: 10px 12px;
    display:flex; gap:12px; overflow-x:auto; z-index:20; scrollbar-width:none;
  }
  .guides::-webkit-scrollbar{display:none}
  .guide-card{
    position:relative; flex:0 0 260px; height:100%;
    background:#151923; border-radius:16px; overflow:hidden;
    box-shadow:0 8px 24px rgba(0,0,0,.35);
  }
  .guide-card img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
  .guide-card .shade{
    position:absolute; inset:auto 0 0 0; height:48%;
    background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.75) 65%, rgba(0,0,0,.9) 100%);
  }
  .guide-card .txt{
    position:absolute; left:12px; right:12px; bottom:10px; z-index:2;
    font-size:18px; font-weight:700; line-height:1.25;
  }
  .guide-card .sub{
    margin-top:6px; font-size:13px; font-weight:500; color:#cfd3da;
  }

  /* Bottom nav */
  .nav{
    position:absolute; left:0; right:0; bottom:0;
    height: calc(var(--nav-h) + env(safe-area-inset-bottom, 0px));
    padding:10px 8px calc(10px + env(safe-area-inset-bottom, 0px));
    background:rgba(15,15,20,.92); backdrop-filter: blur(6px);
    border-top:1px solid rgba(255,255,255,.06);
    display:flex; align-items:flex-end; justify-content:space-around; z-index:25;
  }
  .tab{
    position:relative; display:flex; flex-direction:column; align-items:center; gap:6px;
    font-size:12px; color:#cfcfd3; text-decoration:none; min-width:86px;
  }
  .tab i{font-size:22px; opacity:.9}
  .tab.active{color:#fff}
  .tab.active i{color:var(--accent)}
  .underline{
    position:absolute; bottom:6px; height:4px; border-radius:2px;
    background:var(--accent); transition: left .25s ease, width .25s ease;
  }

  /* Markers */
  .dot-marker{
    width:12px; height:12px; border-radius:50%;
    background:#fff; border:2px solid rgba(0,0,0,.35);
    box-shadow:0 0 6px rgba(0,0,0,.35);
  }
  .photo-marker{
    width:42px; height:42px; border-radius:50%; overflow:hidden;
    border:3px solid #fff; box-shadow:0 0 8px rgba(0,0,0,.45);
    background:#999; transform-origin:center; transition:transform .12s ease;
  }
  .photo-marker img{width:100%; height:100%; object-fit:cover; display:block}
</style>
</head>
<body>

  <header>HodoGuides</header>

  <div class="search-bar">
    <input type="text" placeholder="Search a guide..." />
  </div>

  <div id="map"></div>

  <!-- Guides -->
  <div class="guides">
    <a class="guide-card" href="#" aria-label="Okinawa Guide">
      <img src="https://images.unsplash.com/photo-1549692520-acc6669e2f0c?q=80&w=1400&auto=format&fit=crop" alt="Okinawa" />
      <div class="shade"></div>
      <div class="txt">Okinawa – Islands & Hidden Spots
        <div class="sub">7 days</div>
      </div>
    </a>
    <a class="guide-card" href="#" aria-label="Tokyo Guide">
      <img src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?q=80&w=1400&auto=format&fit=crop" alt="Tokyo" />
      <div class="shade"></div>
      <div class="txt">Tokyo – City Highlights
        <div class="sub">10 stops</div>
      </div>
    </a>
    <a class="guide-card" href="#" aria-label="Kyoto Guide">
      <img src="https://images.unsplash.com/photo-1545569341-9eb8b30979d9?q=80&w=1400&auto=format&fit=crop" alt="Kyoto" />
      <div class="shade"></div>
      <div class="txt">Kyoto – Temples & Gardens
        <div class="sub">3 days</div>
      </div>
    </a>
  </div>

  <!-- Bottom nav -->
  <nav class="nav" id="bottomNav">
    <a class="tab active" data-tab="0" href="#"><i class="fa-solid fa-compass"></i><span>Explore</span></a>
    <a class="tab" data-tab="1" href="#"><i class="fa-solid fa-book-open"></i><span>My Guides</span></a>
    <a class="tab" data-tab="2" href="#"><i class="fa-solid fa-heart"></i><span>Favorites</span></a>
    <div class="underline" id="navUnderline"></div>
  </nav>

<script>
  // --- Map ---
  mapboxgl.accessToken = "pk.eyJ1IjoiZXJpa2FyYW1lbGwiLCJhIjoiY21jbmlteXJuMDBjaDJrc2swbnA0a29wZSJ9.F8aX2alF-PpnqInkyqba8g";
  const map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/erikaramell/cmcnjverq008y01qw6rir46gy",
    projection: "globe",
    center: [10, 20],
    zoom: 0.3
  });
  map.on("style.load", () => map.setFog({}));

  // --- Markers data ---
  const spots = [
    {
      name: "Japan",
      coords: [139.6917, 35.6895],
      img: "https://images.unsplash.com/photo-1526481280698-8fcc13fd91c0?q=80&w=200&auto=format&fit=crop",
      url: "#japan"
    },
    {
      name: "South Korea",
      coords: [126.9780, 37.5665],
      img: "https://images.unsplash.com/photo-1603808033115-67b3a2bfa4fd?q=80&w=200&auto=format&fit=crop",
      url: "#korea"
    }
  ];

  // Pour chaque pays : on crée 2 versions du marker (dot + photo) et on bascule selon le zoom
  const markerBundles = []; // {dotEl, photoEl, marker, photoMarker}
  spots.forEach(s => {
    // Dot (petit)
    const dotEl = document.createElement("div");
    dotEl.className = "dot-marker";
    const marker = new mapboxgl.Marker(dotEl).setLngLat(s.coords).addTo(map);

    // Photo (zoom proche)
    const photoEl = document.createElement("div");
    photoEl.className = "photo-marker";
    const im = document.createElement("img");
    im.src = s.img; im.alt = s.name;
    photoEl.appendChild(im);
    photoEl.addEventListener("click", () => window.location.href = s.url);
    const photoMarker = new mapboxgl.Marker(photoEl).setLngLat(s.coords).addTo(map);

    markerBundles.push({dotEl, photoEl, marker, photoMarker});
  });

  // seuils de zoom (ajuste si tu veux)
  const SHOW_PHOTO_AT = 1.8;   // au-dessus de ce zoom on montre la photo
  const DOT_BASE = 12;         // taille base du dot
  const PHOTO_BASE = 42;       // taille base de la photo

  function refreshMarkers(){
    const z = map.getZoom();
    markerBundles.forEach(b => {
      // toggle visibility
      b.dotEl.style.display   = (z < SHOW_PHOTO_AT) ? "block" : "none";
      b.photoEl.style.display = (z >= SHOW_PHOTO_AT) ? "block" : "none";

      // légère mise à l’échelle
      const dotScale = Math.max(0.7, Math.min(1.25, 0.7 + z*0.15));
      const photoScale = Math.max(0.85, Math.min(1.35, 0.85 + (z-1.8)*0.12));

      b.dotEl.style.width  = (DOT_BASE*dotScale) + "px";
      b.dotEl.style.height = (DOT_BASE*dotScale) + "px";
      b.photoEl.style.transform = `scale(${photoScale})`;
    });
  }
  map.on("load", refreshMarkers);
  map.on("zoom", refreshMarkers);

  // --- Underline nav se place sous l’onglet actif ---
  const nav = document.getElementById('bottomNav');
  const underline = document.getElementById('navUnderline');
  function positionUnderline(){
    const active = nav.querySelector('.tab.active');
    if(!active) return;
    const rectNav = nav.getBoundingClientRect();
    const rect = active.getBoundingClientRect();
    underline.style.width = Math.max(60, rect.width * 0.7) + "px";
    underline.style.left = (rect.left - rectNav.left + (rect.width - parseFloat(underline.style.width))/2) + "px";
  }
  positionUnderline();
  window.addEventListener('resize', positionUnderline);
  nav.querySelectorAll('.tab').forEach(t=>{
    t.addEventListener('click', e=>{
      nav.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      positionUnderline();
      e.preventDefault();
    });
  });
</script>
</body>
</html>