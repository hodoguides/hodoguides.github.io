<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HodoGuides</title>

<link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
  :root{ --nav-h:72px; --cards-h:160px; --accent:#8f88ff; }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter;
    color:#fff; background:#0e1420; overflow:hidden;
    background-image:
      radial-gradient(ellipse at 50% 40%, #1d2845 0%, #0e1420 60%, #0b0f18 100%),
      radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.18) 0, rgba(255,255,255,0) 100%),
      radial-gradient(2px 2px at 70% 60%, rgba(255,255,255,.14) 0, rgba(255,255,255,0) 100%),
      radial-gradient(1.5px 1.5px at 40% 80%, rgba(255,255,255,.10) 0, rgba(255,255,255,0) 100%);
    background-repeat:no-repeat;
  }
  header{position:absolute; left:20px; top:20px; z-index:10; font-weight:800; font-size:28px; letter-spacing:.3px; text-shadow:0 2px 10px rgba(0,0,0,.35);}
  .search-bar{position:absolute; left:50%; top:74px; transform:translateX(-50%); width:min(820px,86%); z-index:10;}
  .search-bar input{width:100%; padding:14px 18px; font-size:16px; color:#fff; background:rgba(255,255,255,.14); border:0; border-radius:28px; outline:none; backdrop-filter: blur(6px);}
  #map{position:absolute; top:0; left:0; right:0; bottom:0; width:100%; min-height:100vh; padding-bottom: calc(var(--cards-h) + var(--nav-h) + env(safe-area-inset-bottom, 0px)); z-index:0;}

  .guides{position:absolute; left:0; right:0; bottom: calc(var(--nav-h) + 10px + env(safe-area-inset-bottom, 0px)); height: var(--cards-h); padding: 10px 12px; display:flex; gap:12px; overflow-x:auto; z-index:20; scrollbar-width:none;}
  .guides::-webkit-scrollbar{display:none}
  .guide-card{position:relative; flex:0 0 260px; height:100%; background:#151923; border-radius:16px; overflow:hidden; box-shadow:0 8px 24px rgba(0,0,0,.35); text-decoration:none;}
  .guide-card img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
  .guide-card .shade{position:absolute; inset:auto 0 0 0; height:52%; background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.78) 60%, rgba(0,0,0,.92) 100%);}
  .guide-card .txt{position:absolute; left:12px; right:12px; bottom:12px; z-index:2; font-size:18px; font-weight:800; line-height:1.25;}
  .guide-card .sub{ margin-top:6px; font-size:13px; font-weight:600; color:#e9edf6; opacity:.9 }
  .guide-card .txt, .guide-card .txt *{ color:#fff !important; text-decoration:none !important }

  .nav{position:absolute; left:0; right:0; bottom:0; height: calc(var(--nav-h) + env(safe-area-inset-bottom, 0px)); padding:10px 8px calc(10px + env(safe-area-inset-bottom, 0px)); background:rgba(15,15,20,.92); backdrop-filter: blur(6px); border-top:1px solid rgba(255,255,255,.06); display:flex; align-items:flex-end; justify-content:space-around; z-index:25;}
  .tab{position:relative; display:flex; flex-direction:column; align-items:center; gap:6px; font-size:12px; color:#cfcfd3; text-decoration:none; min-width:86px;}
  .tab i{font-size:22px; opacity:.9}
  .tab.active{color:#fff}
  .tab.active i{color:var(--accent)}
  .underline{position:absolute; bottom:6px; height:4px; border-radius:2px; background:var(--accent); transition: left .25s ease, width .25s ease;}

  /* Markers */
  .dot-marker{ width:8px; height:8px; border-radius:50%; background:#fff; border:2px solid rgba(0,0,0,.35); box-shadow:0 0 6px rgba(0,0,0,.35); }
  .photo-marker{ width:38px; height:38px; border-radius:50%; overflow:hidden; border:3px solid #fff; box-shadow:0 0 8px rgba(0,0,0,.45); background:#999; cursor:pointer; }
  .photo-marker img{width:100%; height:100%; object-fit:cover; display:block}

  /* SEARCH OVERLAY */
  .search-overlay{
    position:fixed; inset:0; z-index:50; display:none;
    background:#fff; color:#0d1220;
  }
  .search-overlay.open{display:block;}
  .so-top{
    position:sticky; top:0; background:#fff; padding:10px 12px; border-bottom:1px solid #eceff5; z-index:2;
    display:flex; gap:10px; align-items:center;
  }
  .so-back{width:44px; height:44px; border-radius:12px; background:#f2f4f8; display:grid; place-items:center; cursor:pointer;}
  .so-input{flex:1}
  .so-input input{
    width:100%; height:44px; border-radius:22px; border:0; background:#f2f4f8; padding:0 16px;
    font-size:16px; color:#0d1220; outline:none;
  }
  .so-section-title{
    font-weight:800; letter-spacing:.04em; color:#4a5568; font-size:12px;
    padding:14px 16px; background:#f6f9fd; border-top:1px solid #edf2f7; border-bottom:1px solid #edf2f7;
  }
  .so-list{list-style:none; margin:0; padding:0}
  .so-item{
    display:flex; align-items:center; gap:12px; padding:14px 16px; cursor:pointer; border-bottom:1px solid #f2f4f8;
  }
  .so-pin{width:36px; height:36px; border-radius:10px; background:#fff; border:1px solid #e6eaf2; display:grid; place-items:center; color:#111;}
  .so-name{font-size:16px; font-weight:600; color:#111;}
  .so-muted{font-size:13px; color:#6b7280;}
</style>
</head>
<body>

  <header>HodoGuides</header>

  <div class="search-bar">
    <input id="mainSearch" type="text" placeholder="Search a guide..." />
  </div>

  <div id="map"></div>

  <div class="guides">
    <a class="guide-card" href="#">
      <img src="https://images.unsplash.com/photo-1549692520-acc6669e2f0c?q=80&w=1400&auto=format&fit=crop" alt="Okinawa" />
      <div class="shade"></div>
      <div class="txt">Okinawa – Islands & Hidden Spots<div class="sub">7 days</div></div>
    </a>
    <a class="guide-card" href="#">
      <img src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?q=80&w=1400&auto=format&fit=crop" alt="Tokyo" />
      <div class="shade"></div>
      <div class="txt">Tokyo – City Highlights<div class="sub">10 stops</div></div>
    </a>
    <a class="guide-card" href="#">
      <img src="https://images.unsplash.com/photo-1545569341-9eb8b30979d9?q=80&w=1400&auto=format&fit=crop" alt="Kyoto" />
      <div class="shade"></div>
      <div class="txt">Kyoto – Temples & Gardens<div class="sub">3 days</div></div>
    </a>
  </div>

  <!-- Bottom nav -->
  <nav class="nav" id="bottomNav">
    <a class="tab active" data-tab="0" href="#"><i class="fa-solid fa-compass"></i><span>Explore</span></a>
    <a class="tab" data-tab="1" href="#"><i class="fa-solid fa-book-open"></i><span>My Guides</span></a>
    <a class="tab" data-tab="2" href="#"><i class="fa-solid fa-heart"></i><span>Favorites</span></a>
    <div class="underline" id="navUnderline"></div>
  </nav>

  <!-- SEARCH OVERLAY -->
  <div class="search-overlay" id="searchOverlay" role="dialog" aria-modal="true">
    <div class="so-top">
      <div class="so-back" id="soBack" title="Close"><i class="fa-solid fa-chevron-left"></i></div>
      <div class="so-input"><input id="soInput" type="text" placeholder="Rechercher un guide" autocomplete="off"></div>
    </div>

    <div class="so-section-title">DESTINATIONS</div>
    <ul class="so-list" id="destList"><!-- injected --></ul>
  </div>

<script>
  // --- Map ---
  mapboxgl.accessToken = "pk.eyJ1IjoiZXJpa2FyYW1lbGwiLCJhIjoiY21jbmlteXJuMDBjaDJrc2swbnA0a29wZSJ9.F8aX2alF-PpnqInkyqba8g";
  const map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/erikaramell/cmcnjverq008y01qw6rir46gy",
    projection: "globe",
    center: [10, 20],
    zoom: 0.3
  });
  map.on("style.load", () => map.setFog({}));

  function applyCameraPadding(){
    const styles = getComputedStyle(document.documentElement);
    const cards = parseInt(styles.getPropertyValue('--cards-h')) || 160;
    const nav   = parseInt(styles.getPropertyValue('--nav-h'))   || 72;
    map.setPadding({ top: 90, right: 0, left: 0, bottom: cards + nav + 16 });
    setTimeout(()=>map.resize(), 0);
  }
  map.on("load", applyCameraPadding);
  window.addEventListener('resize', applyCameraPadding);

  // Spots (ensure japan.html / south-korea.html exist in the same folder)
  const spots = [
    { name:"Japan",       coords:[138.0, 36.0], img:"images/japan.jpg", url:"japan.html" },
    { name:"South Korea", coords:[127.8, 36.3], img:"images/korea.jpg", url:"south-korea.html" }
  ];
  const bundles=[];
  spots.forEach(s=>{
    const d=document.createElement('div'); d.className='dot-marker';
    new mapboxgl.Marker(d,{anchor:'center'}).setLngLat(s.coords).addTo(map);

    const p=document.createElement('div'); p.className='photo-marker'; p.title=s.name;
    const im=document.createElement('img'); im.src=s.img; im.alt=s.name; p.appendChild(im);
    p.addEventListener('click',()=>location.href=s.url);
    new mapboxgl.Marker(p,{anchor:'center'}).setLngLat(s.coords).addTo(map);

    bundles.push({d,p});
  });

  const SHOW_PHOTO_AT=3.2;
  const DOT_MIN=6, DOT_MAX=10, PHOTO_MIN=34, PHOTO_MAX=48;
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  function refreshMarkers(){
    const z=map.getZoom();
    bundles.forEach(b=>{
      const show=z>=SHOW_PHOTO_AT;
      b.d.style.display=show?'none':'block';
      b.p.style.display=show?'block':'none';
      const dotSize=clamp(6+(z-0.3)*1.0, DOT_MIN, DOT_MAX);
      const photoSize=clamp(34+(z-SHOW_PHOTO_AT)*3.0, PHOTO_MIN, PHOTO_MAX);
      b.d.style.width=b.d.style.height=dotSize+'px';
      b.p.style.width=b.p.style.height=photoSize+'px';
    });
  }
  map.on('load', refreshMarkers);
  map.on('zoom', refreshMarkers);

  // --- Bottom nav underline
  const navEl=document.getElementById('bottomNav');
  const underline=document.getElementById('navUnderline');
  function positionUnderline(){
    const active=navEl.querySelector('.tab.active'); if(!active) return;
    const navR=navEl.getBoundingClientRect(), r=active.getBoundingClientRect();
    const w=Math.max(60, r.width*0.68);
    underline.style.width=w+'px';
    underline.style.left=(r.left-navR.left+(r.width-w)/2)+'px';
  }
  positionUnderline();
  window.addEventListener('resize', positionUnderline);
  navEl.querySelectorAll('.tab').forEach(t=>{
    t.addEventListener('click',e=>{
      navEl.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      t.classList.add('active'); positionUnderline(); e.preventDefault();
    });
  });

  // --- SEARCH OVERLAY ---
  const overlay = document.getElementById('searchOverlay');
  const mainSearch = document.getElementById('mainSearch');
  const soInput = document.getElementById('soInput');
  const soBack = document.getElementById('soBack');
  const destList = document.getElementById('destList');

  // Sample destinations: countries + cities
  const destinations = [
    { label:'Corée du Sud',  slug:'south-korea', type:'country', url:'south-korea.html' },
    { label:'Japon',         slug:'japan',       type:'country', url:'japan.html' },
    { label:'Tokyo',         slug:'tokyo',       type:'city',    url:'japan.html#tokyo' },
    { label:'Kyoto',         slug:'kyoto',       type:'city',    url:'japan.html#kyoto' },
    { label:'Osaka',         slug:'osaka',       type:'city',    url:'japan.html#osaka' },
    { label:'Séoul',         slug:'seoul',       type:'city',    url:'south-korea.html#seoul' },
    { label:'Busan',         slug:'busan',       type:'city',    url:'south-korea.html#busan' }
  ];

  function renderList(query=''){
    const q = query.trim().toLowerCase();
    destList.innerHTML = '';
    destinations
      .filter(d => !q || d.label.toLowerCase().includes(q))
      .forEach(d=>{
        const li = document.createElement('li');
        li.className = 'so-item';
        li.innerHTML = `
          <div class="so-pin"><i class="fa-solid fa-location-dot"></i></div>
          <div>
            <div class="so-name">${d.label}</div>
            <div class="so-muted">${d.type === 'country' ? 'Pays' : 'Ville'}</div>
          </div>`;
        li.addEventListener('click', ()=>{ location.href = d.url; });
        destList.appendChild(li);
      });
    if(!destList.children.length){
      const empty=document.createElement('li');
      empty.className='so-item';
      empty.innerHTML='<div class="so-muted">Aucun résultat</div>';
      destList.appendChild(empty);
    }
  }

  function openOverlay(){
    overlay.classList.add('open');
    document.body.style.overflow='hidden';
    setTimeout(()=>soInput.focus(), 50);
    renderList();
  }
  function closeOverlay(){
    overlay.classList.remove('open');
    document.body.style.overflow='';
    mainSearch.blur();
  }

  mainSearch.addEventListener('focus', openOverlay);
  soBack.addEventListener('click', closeOverlay);
  overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeOverlay(); });
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && overlay.classList.contains('open')) closeOverlay(); });
  soInput.addEventListener('input', (e)=>renderList(e.target.value));
</script>
</body>
</html>