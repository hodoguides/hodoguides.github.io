<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HodoGuides</title>

  <!-- Favicon -->
  <link rel="icon" href="images/favicon.png" type="image/png" />

  <!-- Mapbox + Icons -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{ --nav-h:72px; --accent:#7e8db0; }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter;
      color:#fff; background:#0e1420; overflow:hidden;
      background-image:
        radial-gradient(ellipse at 50% 40%, #1d2845 0%, #0e1420 60%, #0b0f18 100%),
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.18) 0, rgba(255,255,255,0) 100%),
        radial-gradient(2px 2px at 70% 60%, rgba(255,255,255,.14) 0, rgba(255,255,255,0) 100%),
        radial-gradient(1.5px 1.5px at 40% 80%, rgba(255,255,255,.10) 0, rgba(255,255,255,0) 100%);
      background-repeat:no-repeat;
    }

    /* Header with "by Erika" image */
    header{
      position:absolute; left:20px; top:20px; z-index:10;
      display:flex; align-items:center; gap:10px;
      text-shadow:0 2px 10px rgba(0,0,0,.35);
    }
    .brand-title{
      font-weight:800; font-size:28px; letter-spacing:.3px;
    }
    .by-erika{
      height:28px; opacity:.95; pointer-events:none;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,.35));
      transform: translateY(2px);
    }
    @media (max-width:480px){
      .brand-title{ font-size:26px; }
      .by-erika{ height:22px; }
    }

    .search-bar{position:absolute; left:50%; top:74px; transform:translateX(-50%); width:min(820px,86%); z-index:10;}
    .search-bar input{width:100%; padding:14px 18px; font-size:16px; color:#fff; background:rgba(255,255,255,.14); border:0; border-radius:28px; outline:none; backdrop-filter: blur(6px);}

    #map{position:absolute; top:0; left:0; right:0; bottom:0; width:100%; min-height:100vh; padding-bottom: calc(var(--nav-h) + env(safe-area-inset-bottom, 0px)); z-index:0;}

    /* Bottom nav */
    .nav{
      position:absolute; left:0; right:0; bottom:0;
      height: calc(var(--nav-h) + env(safe-area-inset-bottom, 0px));
      padding:10px 8px calc(10px + env(safe-area-inset-bottom, 0px));
      background:rgba(15,15,20,.92); backdrop-filter: blur(6px);
      border-top:1px solid rgba(255,255,255,.06);
      display:flex; align-items:flex-end; justify-content:space-around; z-index:25;
    }
    .tab{position:relative; display:flex; flex-direction:column; align-items:center; gap:6px; font-size:12px; color:#cfcfd3; text-decoration:none; min-width:86px;}
    .tab i{font-size:22px; opacity:.9}
    .tab.active{color:#fff}
    .tab.active i{color:var(--accent)}
    .underline{position:absolute; bottom:6px; height:4px; border-radius:2px; background:var(--accent); transition: left .25s ease, width .25s ease;}

    /* Markers */
    .dot-marker{ width:8px; height:8px; border-radius:50%; background:#fff; border:2px solid rgba(0,0,0,.35); box-shadow:0 0 6px rgba(0,0,0,.35); }
    .photo-marker{ width:38px; height:38px; border-radius:50%; overflow:hidden; border:3px solid #fff; box-shadow:0 0 8px rgba(0,0,0,.45); background:#999; cursor:pointer; }
    .photo-marker img{width:100%; height:100%; object-fit:cover; display:block}

    /* SEARCH OVERLAY */
    .search-overlay{
      position:fixed; inset:0; z-index:50; display:none;
      background:#fff; color:#0d1220;
    }
    .search-overlay.open{display:block;}
    .so-top{
      position:sticky; top:0; background:#fff; padding:10px 12px; border-bottom:1px solid #eceff5; z-index:2;
      display:flex; gap:10px; align-items:center;
    }
    .so-back{width:44px; height:44px; border-radius:12px; background:#f2f4f8; display:grid; place-items:center; cursor:pointer;}
    .so-input{flex:1}
    .so-input input{
      width:100%; height:44px; border-radius:22px; border:0; background:#f2f4f8; padding:0 16px;
      font-size:16px; color:#0d1220; outline:none;
    }
    .so-section-title{
      font-weight:800; letter-spacing:.04em; color:#4a5568; font-size:12px;
      padding:14px 16px; background:#f6f9fd; border-top:1px solid #edf2f7; border-bottom:1px solid #edf2f7;
    }
    .so-list{list-style:none; margin:0; padding:0}
    .so-item{
      display:flex; align-items:center; gap:12px; padding:14px 16px; cursor:pointer; border-bottom:1px solid #f2f4f8;
    }
    .so-pin{width:36px; height:36px; border-radius:10px; background:#fff; border:1px solid #e6eaf2; display:grid; place-items:center; color:#111;}
    .so-name{font-size:16px; font-weight:600; color:#111;}
    .so-muted{font-size:13px; color:#6b7280;}
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="brand-title">HodoGuides</div>
    <img class="by-erika" src="images/erika-logo.png" alt="by Erika" />
  </header>

  <div class="search-bar">
    <input id="mainSearch" type="text" placeholder="Search a guide..." />
  </div>

  <div id="map"></div>

  <nav class="nav" id="bottomNav">
    <a class="tab active" href="./"><i class="fa-solid fa-compass"></i><span>Explore</span></a>
    <a class="tab" href="my-guides/"><i class="fa-solid fa-book-open"></i><span>My Guides</span></a>
    <a class="tab" href="tips/"><i class="fa-solid fa-lightbulb"></i><span>Conseils</span></a>
    <div class="underline" id="navUnderline"></div>
  </nav>

  <!-- SEARCH OVERLAY -->
  <div class="search-overlay" id="searchOverlay" role="dialog" aria-modal="true">
    <div class="so-top">
      <div class="so-back" id="soBack" title="Close"><i class="fa-solid fa-chevron-left"></i></div>
      <div class="so-input"><input id="soInput" type="text" placeholder="Rechercher un guide" autocomplete="off"></div>
    </div>

    <div class="so-section-title">DESTINATIONS</div>
    <ul class="so-list" id="destList"><!-- injected --></ul>
  </div>

<script>
  // --- Map ---
  mapboxgl.accessToken = "pk.eyJ1IjoiZXJpa2FyYW1lbGwiLCJhIjoiY21jbmlteXJuMDBjaDJrc2swbnA0a29wZSJ9.F8aX2alF-PpnqInkyqba8g";
  const map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/erikaramell/cmcnjverq008y01qw6rir46gy",
    projection: "globe",
    center: [10, 20],
    zoom: 0.3
  });
  map.on("style.load", () => map.setFog({}));

  // Marqueurs pays
  const spots = [
    { name:"Japan",       coords:[138.0, 36.0], img:"images/japan.jpg", url:"japan/" },
    { name:"South Korea", coords:[127.8, 36.3], img:"images/korea.jpg", url:"south-korea/" }
  ];
  const bundles=[];
  spots.forEach(s=>{
    const d=document.createElement('div'); d.className='dot-marker';
    new mapboxgl.Marker(d,{anchor:'center'}).setLngLat(s.coords).addTo(map);

    const p=document.createElement('div'); p.className='photo-marker'; p.title=s.name;
    const im=document.createElement('img'); im.src=s.img; im.alt=s.name; p.appendChild(im);
    p.addEventListener('click',()=>location.href=s.url);
    new mapboxgl.Marker(p,{anchor:'center'}).setLngLat(s.coords).addTo(map);

    bundles.push({d,p});
  });

  const SHOW_PHOTO_AT=3.2;
  function refreshMarkers(){
    const z=map.getZoom();
    bundles.forEach(b=>{
      const show=z>=SHOW_PHOTO_AT;
      b.d.style.display=show?'none':'block';
      b.p.style.display=show?'block':'none';
    });
  }
  map.on('load', refreshMarkers);
  map.on('zoom', refreshMarkers);

  // --- Bottom nav underline
  const navEl=document.getElementById('bottomNav');
  const underline=document.getElementById('navUnderline');
  function positionUnderline(){
    const active=navEl.querySelector('.tab.active'); if(!active) return;
    const navR=navEl.getBoundingClientRect(), r=active.getBoundingClientRect();
    const w=Math.max(60, r.width*0.68);
    underline.style.width=w+'px';
    underline.style.left=(r.left-navR.left+(r.width-w)/2)+'px';
  }
  positionUnderline();
  window.addEventListener('resize', positionUnderline);
  navEl.querySelectorAll('.tab').forEach(t=>{
    t.addEventListener('click',e=>{
      navEl.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      t.classList.add('active'); positionUnderline(); e.preventDefault();
    });
  });

  // --- SEARCH OVERLAY ---
  const overlay = document.getElementById('searchOverlay');
  const mainSearch = document.getElementById('mainSearch');
  const soInput = document.getElementById('soInput');
  const soBack = document.getElementById('soBack');
  const destList = document.getElementById('destList');

  const destinations = [
    { label:'Japan', type:'country', url:'japan/' },
    { label:'South Korea', type:'country', url:'south-korea/' },
    { label:'Tokyo', type:'city', url:'japan/#tokyo' },
    { label:'Kyoto', type:'city', url:'japan/#kyoto' },
    { label:'Osaka', type:'city', url:'japan/#osaka' },
    { label:'Okinawa', type:'city', url:'japan/#okinawa' },
    { label:'Ishigaki', type:'city', url:'japan/#ishigaki' },
    { label:'Yonaguni', type:'city', url:'japan/#yonaguni' },
    { label:'Seoul', type:'city', url:'south-korea/#seoul' },
    { label:'Busan', type:'city', url:'south-korea/#busan' },
    { label:'Jeju', type:'city', url:'south-korea/#jeju' },
    { label:'Daegu', type:'city', url:'south-korea/#daegu' },
    { label:'Gyeongju', type:'city', url:'south-korea/#gyeongju' },
    { label:'Andong', type:'city', url:'south-korea/#andong' },
    { label:'Sokcho', type:'city', url:'south-korea/#sokcho' }
  ];

  function renderList(query=''){
    const q = query.trim().toLowerCase();
    destList.innerHTML = '';
    destinations
      .filter(d => !q || d.label.toLowerCase().includes(q))
      .forEach(d=>{
        const li = document.createElement('li');
        li.className = 'so-item';
        li.innerHTML = `
          <div class="so-pin"><i class="fa-solid fa-location-dot"></i></div>
          <div>
            <div class="so-name">${d.label}</div>
            <div class="so-muted">${d.type === 'country' ? 'Country' : 'City'}</div>
          </div>`;
        li.addEventListener('click', ()=>{ location.href = d.url; });
        destList.appendChild(li);
      });
    if(!destList.children.length){
      const empty=document.createElement('li');
      empty.className='so-item';
      empty.innerHTML='<div class="so-muted">No results</div>';
      destList.appendChild(empty);
    }
  }

  function openOverlay(){
    overlay.classList.add('open');
    document.body.style.overflow='hidden';
    setTimeout(()=>soInput.focus(), 50);
    renderList();
  }
  function closeOverlay(){
    overlay.classList.remove('open');
    document.body.style.overflow='';
    mainSearch.blur();
  }

  mainSearch.addEventListener('focus', openOverlay);
  soBack.addEventListener('click', closeOverlay);
  overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeOverlay(); });
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && overlay.classList.contains('open')) closeOverlay(); });
  soInput.addEventListener('input', (e)=>renderList(e.target.value));
</script>
</body>
</html>