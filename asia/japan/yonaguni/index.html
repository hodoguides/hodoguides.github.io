<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>HodoGuides · Yonaguni</title>

  <link rel="icon" href="../../images/favicon.png" type="image/png"/>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{ --nav-h:72px; --accent:#7e8db0; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter;
      color:#fff; background:#0e1420; overflow:hidden;
      background-image:
        radial-gradient(ellipse at 50% 40%, #1d2845 0%, #0e1420 60%, #0b0f18 100%),
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.18) 0, rgba(255,255,255,0) 100%),
        radial-gradient(2px 2px at 70% 60%, rgba(255,255,255,.14) 0, rgba(255,255,255,0) 100%);
      background-repeat:no-repeat;
    }

    /* Top bar */
    .topbar{
      position:absolute; left:12px; right:12px; top:12px; z-index:20;
      display:flex; align-items:center; gap:10px;
    }
    .back{
      display:inline-flex; align-items:center; gap:8px;
      background:rgba(255,255,255,.14); padding:10px 14px; border-radius:14px;
      text-decoration:none; color:#fff; backdrop-filter: blur(6px);
    }
    .title{ font-weight:800; font-size:18px; opacity:.95 }

    #map{ position:absolute; inset:0; padding-bottom: var(--nav-h); }

    /* Photo bubble markers */
    .dot-marker{ width:8px; height:8px; border-radius:50%; background:#fff; border:2px solid rgba(0,0,0,.35); box-shadow:0 0 6px rgba(0,0,0,.35); }
    .photo-marker{ width:40px; height:40px; border-radius:50%; overflow:hidden; border:3px solid #fff; box-shadow:0 0 8px rgba(0,0,0,.45); background:#999; cursor:pointer; }
    .photo-marker img{ width:100%; height:100%; object-fit:cover; display:block }

    /* Popup */
    .popup{ color:#0d1220; font-family:inherit; }
    .popup .name{font-weight:800; margin-bottom:4px;}
    .popup .row{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;}
    .popup a{display:inline-block; padding:6px 10px; border-radius:10px; background:#0e1420; color:#fff; text-decoration:none; font-weight:700; font-size:13px}

    /* Bottom nav (same style as Explore/My Guides/Tips) */
    .nav{
      position:absolute; left:0; right:0; bottom:0;
      height: calc(var(--nav-h) + env(safe-area-inset-bottom, 0px));
      padding:10px 8px calc(10px + env(safe-area-inset-bottom, 0px));
      background:rgba(15,15,20,.92); backdrop-filter: blur(6px);
      border-top:1px solid rgba(255,255,255,.06);
      display:flex; align-items:flex-end; justify-content:space-around; z-index:25;
    }
    .tab{position:relative; display:flex; flex-direction:column; align-items:center; gap:6px; font-size:12px; color:#cfcfd3; text-decoration:none; min-width:86px;}
    .tab i{font-size:22px; opacity:.9}
    .tab.active{color:#fff}
    .tab.active i{color:var(--accent)}
    .underline{position:absolute; bottom:6px; height:4px; border-radius:2px; background:var(--accent); width:80px; left:50%; transform:translateX(-50%);}
  </style>
</head>
<body>

  <!-- Top -->
  <div class="topbar">
    <a class="back" href="./"><i class="fa-solid fa-chevron-left"></i><span>Japan</span></a>
    <div class="title">Yonaguni — Map</div>
  </div>

  <div id="map"></div>

  <!-- Bottom nav -->
  <nav class="nav">
    <a class="tab" href="../../index.html"><i class="fa-solid fa-compass"></i><span>Explore</span></a>
    <a class="tab" href="../../my-guides/"><i class="fa-solid fa-book-open"></i><span>My Guides</span></a>
    <a class="tab" href="../../tips/"><i class="fa-solid fa-lightbulb"></i><span>Tips</span></a>
    <div class="underline"></div>
  </nav>

<script>
  // Mapbox
  mapboxgl.accessToken = "pk.eyJ1IjoiZXJpa2FyYW1lbGwiLCJhIjoiY21jbmlteXJuMDBjaDJrc2swbnA0a29wZSJ9.F8aX2alF-PpnqInkyqba8g";
  const map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/erikaramell/cmcnjverq008y01qw6rir46gy",
    projection: "globe",
    center: [122.97, 24.47], // centre approx. Yonaguni
    zoom: 10.2
  });
  map.on("style.load", () => map.setFog({}));

  // Spots (coords approx — ajuste si besoin)
  const spots = [
    {
      id: "agarizaki",
      name: "Cape Agarizaki",
      coords: [123.01, 24.47],
      img: "yonaguni/agarizaki.jpg",
      fallback: "https://source.unsplash.com/800x800/?okinawa,cliff"
    },
    {
      id: "irizaki",
      name: "Cape Irizaki",
      coords: [122.93, 24.468],
      img: "yonaguni/irizaki.jpg",
      fallback: "https://source.unsplash.com/800x800/?sunset,cliff,ocean"
    },
    {
      id: "konpira-torii",
      name: "Konpira Shrine (Kotohira-gu) Torii",
      coords: [122.989, 24.457],
      img: "yonaguni/konpira-torii.jpg",
      fallback: "https://source.unsplash.com/800x800/?torii,shrine,japan"
    },
    {
      id: "underwater-ruins",
      name: "Yonaguni Underwater Ruins",
      coords: [122.98, 24.44],
      img: "yonaguni/underwater-ruins.jpg",
      fallback: "https://source.unsplash.com/800x800/?diving,underwater,ruins"
    }
  ];

  // Fit bounds
  map.on("load", () => {
    const b = new mapboxgl.LngLatBounds();
    spots.forEach(s => b.extend(s.coords));
    map.fitBounds(b, { padding: { top: 90, right: 40, bottom: 110, left: 40 }, duration: 0 });
  });

  // Markers (dot + photo bubble by zoom)
  const bundles = [];
  spots.forEach(s => {
    // dot
    const dot = document.createElement('div'); dot.className='dot-marker';
    new mapboxgl.Marker(dot,{anchor:'center'}).setLngLat(s.coords).addTo(map);

    // photo bubble
    const el = document.createElement('div'); el.className='photo-marker'; el.title = s.name;
    const im = document.createElement('img'); im.src = s.img; im.alt = s.name; im.onerror = () => { im.onerror=null; im.src=s.fallback; };
    el.appendChild(im);

    // popup
    const popup = new mapboxgl.Popup({offset:18, closeButton:true})
      .setHTML(`
        <div class="popup">
          <div class="name">${s.name}</div>
          <div class="row">
            <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.name + ' Yonaguni')}" target="_blank" rel="noopener">
              <i class="fa-solid fa-map-location-dot"></i> Open in Maps
            </a>
          </div>
        </div>
      `);

    new mapboxgl.Marker(el,{anchor:'center'}).setLngLat(s.coords).setPopup(popup).addTo(map);
    bundles.push({ d:dot, p:el });
  });

  // Show photo bubbles after a certain zoom
  const SHOW_PHOTO_AT = 10.0;
  function refreshMarkers(){
    const z = map.getZoom();
    bundles.forEach(b => {
      const show = z >= SHOW_PHOTO_AT;
      b.d.style.display = show ? 'none' : 'block';
      b.p.style.display = show ? 'block' : 'none';
    });
  }
  map.on('load', refreshMarkers);
  map.on('zoom', refreshMarkers);
</script>
</body>
</html>